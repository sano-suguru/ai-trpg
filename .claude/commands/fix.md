# 修正タスク

レビュー指摘やエラーを修正する。

## 入力

$ARGUMENTS - 修正対象（レビュー結果ファイル、エラーログ、または問題の説明）

---

## 実行手順

### 1. 問題の把握

**入力を分析:**

- レビュー指摘 → 重大度順にソート
- lint/typecheckエラー → エラーメッセージを解析
- 実行時エラー → スタックトレースを確認

**コンテキスト収集:**

- 該当ファイルを読み込む
- 関連するドメインのREADME.mdを確認
- アーキテクチャドキュメントを参照

### 2. 修正計画

**修正判断（各指摘について評価）:**

- 修正しない場合の実害は何か？（バグ、セキュリティ、保守性低下など）
- 修正のコスト（変更範囲、リスク、時間）は妥当か？
- トレードオフがある場合、どちらを優先すべきか？
  - パフォーマンス vs コード可読性
  - 厳密な型付け vs 開発効率
  - 理想的な設計 vs 変更リスク

判断結果:

- ✅ 修正する → 計画に含める
- ⏸️ 保留する → 理由を記録し、ユーザーに確認
- ❌ 修正しない → 理由を報告に記載

**優先順位（修正するものについて）:**

1. 重大（セキュリティ、アーキテクチャ違反）
2. 警告（バグ、パフォーマンス）
3. 軽微（スタイル、命名）

**影響範囲:**

- 修正による副作用を検討
- 依存するコードへの影響を確認

### 3. 修正実装

**一つずつ確実に:**

- 1つの問題を修正
- 動作確認
- 次の問題へ

**アーキテクチャ遵守:**

- FDM、Vertical Sliceの原則を維持
- 新たなアーキテクチャ違反を作らない

### 4. 検証

```bash
pnpm lint
pnpm typecheck
```

- 全てのエラーと警告が解消されていることを確認
- 修正によって新しい問題が発生していないことを確認

### 5. 動作検証（必須 - 例外なし）

修正が実際に問題を解決したことを検証する。「修正しました」だけでは完了にならない。

#### 5-1. Playwright MCP でブラウザ確認

1. `mcp__playwright__browser_navigate` でアプリを開く
2. 修正した箇所に関連する機能を実際に操作する
3. `mcp__playwright__browser_snapshot` で状態を確認
4. `mcp__playwright__browser_take_screenshot` で修正後のスクリーンショットを撮影

#### 5-2. 関連するE2Eテストの実行

修正箇所に関連するE2Eテストを実行する。

```bash
pnpm --filter @ai-trpg/web e2e
```

- 既存のE2Eテストが全てパスすることを確認
- 必要に応じて、修正を検証する新しいテストケースを追加

### 6. 報告

修正完了後、以下を報告:

1. **修正した問題一覧**
2. **変更ファイル**
3. **検証結果**
4. **スクリーンショット**（修正後の状態）

---

## 出力形式

```markdown
## 修正完了報告

### 修正した問題

| #   | 重大度 | ファイル  | 問題          | 対応                     |
| --- | ------ | --------- | ------------- | ------------------------ |
| 1   | 重大   | xxx.ts:10 | try-catch使用 | Result型に変更           |
| 2   | 警告   | yyy.ts:25 | any型使用     | unknown + 型ガードに変更 |

### 修正しなかった項目

| #   | 重大度 | ファイル  | 問題       | 判断理由                           |
| --- | ------ | --------- | ---------- | ---------------------------------- |
| 3   | 軽微   | zzz.ts:50 | 命名改善案 | 変更範囲が広く、リスクに見合わない |

### 検証結果

- lint: Pass
- typecheck: Pass
- E2E: Pass

### 動作確認

- スクリーンショット: [添付]
- 確認した操作: ◯◯ボタンをクリック → △△が表示されることを確認

### 変更ファイル

- `apps/api/src/features/character/repository.ts`
- `packages/shared/src/domain/character/types.ts`
```
